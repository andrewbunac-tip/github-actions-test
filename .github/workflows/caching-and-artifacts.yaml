# 41. Caching Files in Github Actions
name: Caching and Artifacts
on: [workflow_dispatch]

jobs:
    use-axios:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - name: Cache node modules
              id: cache-dependencies
              uses: actions/cache@v3
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-npm-cache-${{ hashFiles('**/package-lock.json') }} #ubuntu-latest-node-<hash>
                  restore-keys: |
                      ${{ runner.os }}-npm-cache-
                      ${{ runner.os }}-
                    
            - name: Display Cache output
              run: echo '${{ toJson(steps.cache-dependencies.outputs)}}'  

            - name: Install Dependencies
              run: npm install
            - name: Run Test
              run: npm test
            - name: Upload Code Coverage Report
              uses: actions/upload-artifact@v3
              if: always()
              with:
                name: code-coverage
                path: coverage
                retention-days: 10
            - name: Use Axios
              uses: actions/github-script@v6
              with:
                    script: |
                        const axios = require('axios');
                        const res = await axios.get('https://icanhazdadjoke.com/', {
                            headers: {
                                Accept: 'text/plain'
                            }
                        });
                        console.log(res.data);
                